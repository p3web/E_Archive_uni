<link rel="stylesheet" href=""
<div data-ng-app="" data-ng-init="title='build order'">
    <div class="page-title">
        <div class="title_left">
            <h3 id="title">
                <small id="tiny_title" data-ng-bind="title"></small>
            </h3>
        </div>

        <div class="title_right">
        </div>
    </div>
</div>
<div class="clearfix"></div>

<div class="row">
    <div class="col-xs-4 col-md-2 pull-right">
        <label for="date">تاریخ</label>
        <input type="text" class="form-control" id="date">
    </div>
    <div class="col-xs-12">
        <table class="table table-striped table-bordered" id="AddDPB" style="margin-top: 5%;">
            <tbody id="TBODY">
            <tr>
                <th>بارکد</th>
                <th>فوتی</th>
                <th>کوره</th>
                <th>برش کاری</th>
                <th>تراشکاری</th>
                <th>اسید شویی</th>
                <th>کنترل کیفی</th>
                <th>بسته بندی</th>
                <th>انبار محصول</th>
            </tr>
            <tr>
                <td><select id="productID_0" type="text" class="form-control"></select></td>
                <td><input id="Futile_0" type="number" class="form-control"></td>
                <td><input id="Furnace_0" type="number" class="form-control"></td>
                <td><input id="Cutting_0" type="number" class="form-control"></td>
                <td><input id="Turning_0" type="number" class="form-control"></td>
                <td><input id="Pickling_0" type="number" class="form-control"></td>
                <td><input id="qualityControl_0" type="number" class="form-control"></td>
                <td><input id="packing_0" type="number" class="form-control"></td>
                <td><input id="ProductStorage_0" type="number" class="form-control"></td>
                <td>
                    <div class="btn btn-primary" onclick="addNewRow()" id="SaveBtn">جدید</div>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="btn btn-primary" onclick="SaveProgram()">ثبت اطلاعات</div>
    </div>
</div>

<input id="CreateBy" type="hidden">


<script src="plugin/dateConvertor/DateConvertor.js"></script>
<script src="js/products/connection_products.js"></script>
<script src="js/dailyProgramBuild/connection_dailyProductionSchedule.js"></script>

<!--DatePicker-->
<script src="plugin/DatePicker/js/jalali.js"></script>
<script src="plugin/DatePicker/js/calendar.js"></script>
<script src="plugin/DatePicker/js/calendar-setup.js"></script>
<script src="plugin/DatePicker/js/calendar-fa.js"></script>

<script>
    var Rowcounter = 0;
    function addNewRow() {
        Rowcounter++;
        var SaveBtn = document.getElementById('SaveBtn');
        SaveBtn.parentNode.removeChild(SaveBtn);
        var tr = document.createElement('tr');
        var tag = '<td><select id="productID_' + Rowcounter + '" type="text" class="form-control"></select></td>' +
            '<td><input id="Futile_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="Furnace_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="Cutting_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="Turning_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="Pickling_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="qualityControl_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="packing_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><input id="ProductStorage_' + Rowcounter + '" type="number" class="form-control"></td>' +
            '<td><div class="btn btn-primary" onclick="addNewRow()" id="SaveBtn">جدید</div> </td>';
        tr.innerHTML = tag;
        document.getElementById('TBODY').appendChild(tr);

        products_connection.get();
    }


    function GetDate() {
        var Date_Time = new Date();
        var month = Date_Time.getMonth();
        month++;

        if (month.toString().length < 2) {
            month = '0' + month;
        }

        var Day = Date_Time.getDate();
        Day++;
        if (Day.toString().length < 2) {
            Day = '0' + Day;
        }
        var year = Date_Time.getFullYear();

        document.getElementById('date').value = gregorian_to_jalali(year, month, Day).join('/');
    }

    //---------------- onload ------------
    // ---- get Date
    GetDate();

    //---- get barCode
    products_connection.get();
    // ---- get userId
    document.getElementById('CreateBy').value = userDetails.ID;


    function SaveProgram() {
        var i = 0;
        var date = GetTmeStamp('date');
        var loop = function () {
            if (i <= Rowcounter) {
                setTimeout(function () {
                    var productID = document.getElementById('productID_' + i).value;

                    var Futile = document.getElementById('Futile_' + i).value;
                    var Furnace = document.getElementById('Cutting_' + i).value;
                    var Cutting = document.getElementById('Furnace_' + i).value;
                    var Turning = document.getElementById('Turning_' + i).value;
                    var Pickling = document.getElementById('Pickling_' + i).value;
                    var qualityControl = document.getElementById('qualityControl_' + i).value;
                    var packing = document.getElementById('packing_' + i).value;
                    var ProductStorage = document.getElementById('ProductStorage_' + i).value;
                    var CreateBy = document.getElementById('CreateBy').value;

                    dailyProductionSchedule_connection.set(productID, date, Futile, Furnace, Cutting, Turning, Pickling, qualityControl, packing, ProductStorage, CreateBy);
                    i++;
                    loop();
                }, 100);
            } else {
                window.location.href = '#pages/dailyProgramBuild';
            }
        };
        loop();
    }

    //---- date picker

    Calendar.setup({
        inputField: "date",   // id of the input field
        button: "inputpicker",   // trigger for the calendar (button ID)
        ifFormat: "%Y/%m/%d",       // format of the input field
        dateType: 'jalali',
        weekNumbers: false
    });

</script>